# In de juiste volgorde

De tweede puzzel is die van de torens. In het GET request op `/towers` hebben we al bepaald wat de volgorde is die we nu moeten insturen. 

> ### :computer: ***puzzel2 torens***
> 
> Zorg dat we het juiste bericht insturen. Denk hierbij aan:
> 
> - De body van het POST bericht is de json die we reeds hebben opgeslagen
> 
> - De solution header moet worden meegestuurd.  Deze moet uit de collection variabelen komen.

Als we de juiste body en header hebben mee gestuurd krijgen een status 200 en een lijst met testframeworks en programmeertalen.

Ook nu moeten we weer het één en ander scripten om de volgende puzzel op te kunnen lossen. Zoals we eerder (bij de handmatige Postman-escape)hebben bepaald zijn we geinterresseerd in de ontbrekende tool/framework. Om te bepalen welke tool/taal niet in de array voorkomt zullen we een stukje logica in ons script op moeten nemen.  Om dat dit lastiger is dan dat we tot nu toe hebben gedaan doe we deze weer stap-voor-stap 

> ### :keyboard: ***De missende tool/framework***
> 
> - Eerst scripten we wat we al wel kennen. Zorg dat we de status check doen en ook dat we de nieuwe solution header opslaan in de Postman-collection variabelen.
> 
> - Nu moeten we de missende tool/framework vinden. In het respons zien we 4 talen/tools. We weten dat er vijf zijn. We moeten logica schrijven om de array die we in het respons hebben gekregen te vergelijken met de gehele lijst van tools/talen. 
>   
>   ```json
>   ["Postman", "Playwright","Java","Cypress","Python"]
>   ```
> 
> - Wij denken dat je dit het beste met een filter (javascript fuctie) kunt doen. Neem even de tijd (en gerbuik zeger Google, ChatGPT, etc) om zelf een functie te schrijven die de missende tool/taal boven tafel krijgt.



Lukt het niet en kom je er niet uit dan staat hier onder een manier om dit voor elkaar te krijgen. We hebben voor het gemak de status check en de solution header ook opgenomen in de uitwerking.

<details>  
<summary>Ik kan het echt niet vinden geef me een hint</summary>

### Uitwerking

In de uitwerking hebben we een losse fuctie gemaakt die, wanneer je deze de array uit je respons geeft, de missende tool retourneerd.

```javascript
pm.test("Handle solution header", function () {
    //in this test we write the solution header to colection variables
    let solution2 = postman.getResponseHeader("solution2");
    pm.collectionVariables.set("headerPuzzel3", solution2);
});

pm.test("Who we need to call", function () {
    let jsonData = pm.response.json();
    // call findMissingTool funtion to get the missing tool 
    let missingTool = findMissingTool(jsonData.tools);

    // logic to determine who to call


    pm.collectionVariables.set("numberSpecialist", specialistToCall);
});


function findMissingTool(arr) {
    const allItems = ["Postman", "Java", "Cypress", "Python", "Playwright"];
    const missingItem = allItems.filter(item => !arr.includes(item));
    return missingItem[0];
}

pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});
 
```

</details>






